(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
var PARTICLE_RADIUS = 3;
var LINE_WIDTH = 2;
/** Clears the given canvas and draws on it the contents of the given plane. */
function draw(plane, canvas) {
    var ctx = canvas.getContext("2d");
    if (ctx) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (var _i = 0, _a = plane.particles; _i < _a.length; _i++) {
            var particle = _a[_i];
            drawParticle(particle, ctx);
        }
        for (var _b = 0, _c = plane.lines; _b < _c.length; _b++) {
            var line = _c[_b];
            drawLine(line, ctx);
        }
    }
}
exports.draw = draw;
/* Draws the given particle */
function drawParticle(particle, ctx) {
    ctx.beginPath();
    ctx.lineWidth = 1;
    ctx.arc(particle.pos.x, particle.pos.y, PARTICLE_RADIUS, 0, 360);
    ctx.fill();
}
/* Drags the given line */
function drawLine(line, ctx) {
    ctx.beginPath();
    ctx.lineWidth = LINE_WIDTH;
    ctx.moveTo(line.start.x, line.start.y);
    ctx.lineTo(line.end.x, line.end.y);
    ctx.stroke();
}
},{}],2:[function(require,module,exports){
"use strict";
var physics = require('./physics');
var draw = require('./draw');
var plane_1 = require('./plane');
var util = require('./util');
var MIN_MS_BETWEEN_UPDATES = 20; // ~50 FPS
/* Starts the main loop */
function animate(canvas, plane) {
    var lastUpdateTime;
    // Handles all animation frames after the first
    function update(timestamp) {
        requestAnimationFrame(update);
        if (timestamp < lastUpdateTime + MIN_MS_BETWEEN_UPDATES) {
            return;
        }
        physics.advanceTime(plane, (timestamp - lastUpdateTime) / 1000);
        draw.draw(plane, canvas);
        lastUpdateTime = timestamp;
    }
    // Perform initial setup then set animation running.
    requestAnimationFrame(function (timestamp) {
        lastUpdateTime = timestamp;
        requestAnimationFrame(update);
    });
}
;
/* Creates initial objects and starts the main loop */
function start() {
    var plane = new plane_1.default({ x: 0, y: 30 });
    var canvas = document.getElementById('canvas');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    attachDragHandler(canvas, plane);
    addParticles(plane, canvas, 10);
    animate(canvas, plane);
}
/* Adds 'num' random particles to the plane */
function addParticles(plane, canvas, num) {
    for (var i = 0; i < num; i++) {
        var pos = { x: canvas.width / 2, y: canvas.height / 2 };
        var vel = util.getRandomVel(canvas);
        plane.addParticle(pos, vel);
    }
}
/* Attaches events to the canvas to faciliate new particle creation. */
function attachDragHandler(canvas, plane) {
    var startPos;
    canvas.onmousedown = function (evt) {
        startPos = util.getCursorPos(canvas, evt);
    };
    canvas.onmouseup = function (evt) {
        if (startPos != null) {
            var pos = util.getCursorPos(canvas, evt);
            var vel = { x: pos.x - startPos.x, y: pos.y - startPos.y };
            plane.addParticle(pos, vel);
            startPos = null;
        }
    };
}
//
start();
},{"./draw":1,"./physics":3,"./plane":4,"./util":5}],3:[function(require,module,exports){
"use strict";
/* Advances time on the plane by the given number of seconds, applying
 * velocity and gravity. */
function advanceTime(plane, seconds) {
    var particles = plane.particles;
    var lines = plane.lines;
    for (var _i = 0, particles_1 = particles; _i < particles_1.length; _i++) {
        var particle = particles_1[_i];
        particle.vel.x += plane.gravity.x * seconds;
        particle.vel.y += plane.gravity.y * seconds;
        particle.pos.x += particle.vel.x * seconds;
        particle.pos.y += particle.vel.y * seconds;
    }
    return plane;
}
exports.advanceTime = advanceTime;
},{}],4:[function(require,module,exports){
"use strict";
/* Provides a simple Plane implementation. */
var Plane = (function () {
    function Plane(gravity) {
        this.particles = [];
        this.lines = [];
        this.gravity = gravity;
    }
    Plane.prototype.addParticle = function (pos, vel) {
        this.particles.push({ pos: pos, vel: vel });
    };
    Plane.prototype.addLine = function (start, end) {
        this.lines.push({ start: start, end: end });
    };
    return Plane;
}());
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = Plane;
},{}],5:[function(require,module,exports){
"use strict";
/* Fetches coordinates on canvas from mouse click */
function getCursorPos(canvas, event) {
    var rect = canvas.getBoundingClientRect();
    var x = event.clientX - rect.left;
    var y = event.clientY - rect.top;
    return { x: x, y: y };
}
exports.getCursorPos = getCursorPos;
/* Returns a random velocity between 1% - 5% of the size of the canvas */
function getRandomVel(canvas) {
    var w = canvas.width;
    var h = canvas.height;
    var x = (w * 0.01) + (w * 0.04 * Math.random());
    var y = (h * 0.01) + (h * 0.04 * Math.random());
    return { x: x, y: y };
}
exports.getRandomVel = getRandomVel;
},{}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvdHMvZHJhdy50cyIsInNyYy90cy9tYWluLnRzIiwic3JjL3RzL3BoeXNpY3MudHMiLCJzcmMvdHMvcGxhbmUudHMiLCJzcmMvdHMvdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7QUNFQSxJQUFNLGVBQWUsR0FBRyxDQUFDLENBQUM7QUFDMUIsSUFBTSxVQUFVLEdBQUcsQ0FBQyxDQUFDO0FBRXJCLCtFQUErRTtBQUMvRSxjQUFlLEtBQVksRUFBRSxNQUF5QjtJQUVwRCxJQUFJLEdBQUcsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2xDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDUixHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFakQsR0FBRyxDQUFDLENBQWlCLFVBQWUsRUFBZixLQUFBLEtBQUssQ0FBQyxTQUFTLEVBQWYsY0FBZSxFQUFmLElBQWUsQ0FBQztZQUFoQyxJQUFJLFFBQVEsU0FBQTtZQUNmLFlBQVksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUM7U0FDN0I7UUFFRCxHQUFHLENBQUMsQ0FBYSxVQUFXLEVBQVgsS0FBQSxLQUFLLENBQUMsS0FBSyxFQUFYLGNBQVcsRUFBWCxJQUFXLENBQUM7WUFBeEIsSUFBSSxJQUFJLFNBQUE7WUFDWCxRQUFRLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQ3JCO0lBQ0gsQ0FBQztBQUNILENBQUM7QUFtQk8sWUFBSSxRQW5CWDtBQUVELDhCQUE4QjtBQUM5QixzQkFBc0IsUUFBa0IsRUFBRSxHQUE2QjtJQUNyRSxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDaEIsR0FB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O0lBQ0gsWUFBQztBQUFELENBZkEsQUFlQyxJQUFBO0FBRUQ7a0JBQWUsS0FBSyxDQUFDOzs7QUNsQnJCLG9EQUFvRDtBQUNwRCxzQkFBNkIsTUFBMEIsRUFBRSxLQUFLO0lBQzFELElBQUksSUFBSSxHQUFHLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0lBQzFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztJQUNsQyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7SUFDakMsTUFBTSxDQUFDLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUM7QUFDeEIsQ0FBQztBQUxlLG9CQUFZLGVBSzNCLENBQUE7QUFFRCx5RUFBeUU7QUFDekUsc0JBQTZCLE1BQXlCO0lBQ3BELElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUM7SUFDckIsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUN0QixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDaEQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ2hELE1BQU0sQ0FBQyxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDO0FBQ3RCLENBQUM7QUFOZSxvQkFBWSxlQU0zQixDQUFBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImltcG9ydCB7UGxhbmUsIFBhcnRpY2xlLCBMaW5lfSBmcm9tICcuL2ludGVyZmFjZXMnO1xyXG5cclxuY29uc3QgUEFSVElDTEVfUkFESVVTID0gMztcclxuY29uc3QgTElORV9XSURUSCA9IDI7XHJcblxyXG4vKiogQ2xlYXJzIHRoZSBnaXZlbiBjYW52YXMgYW5kIGRyYXdzIG9uIGl0IHRoZSBjb250ZW50cyBvZiB0aGUgZ2l2ZW4gcGxhbmUuICovXHJcbmZ1bmN0aW9uIGRyYXcgKHBsYW5lOiBQbGFuZSwgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCkge1xyXG5cclxuICBsZXQgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcclxuICBpZiAoY3R4KSB7XHJcbiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcblxyXG4gICAgZm9yIChsZXQgcGFydGljbGUgb2YgcGxhbmUucGFydGljbGVzKSB7XHJcbiAgICAgIGRyYXdQYXJ0aWNsZShwYXJ0aWNsZSwgY3R4KTtcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGxldCBsaW5lIG9mIHBsYW5lLmxpbmVzKSB7XHJcbiAgICAgIGRyYXdMaW5lKGxpbmUsIGN0eCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vKiBEcmF3cyB0aGUgZ2l2ZW4gcGFydGljbGUgKi9cclxuZnVuY3Rpb24gZHJhd1BhcnRpY2xlKHBhcnRpY2xlOiBQYXJ0aWNsZSwgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpIHtcclxuICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgY3R4LmxpbmVXaWR0aCA9IDE7XHJcbiAgY3R4LmFyYyhwYXJ0aWNsZS5wb3MueCwgcGFydGljbGUucG9zLnksIFBBUlRJQ0xFX1JBRElVUywgMCwgMzYwKTtcclxuICBjdHguZmlsbCgpO1xyXG59XHJcblxyXG4vKiBEcmFncyB0aGUgZ2l2ZW4gbGluZSAqL1xyXG5mdW5jdGlvbiBkcmF3TGluZShsaW5lOiBMaW5lLCBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCkge1xyXG4gIGN0eC5iZWdpblBhdGgoKTtcclxuICBjdHgubGluZVdpZHRoID0gTElORV9XSURUSDtcclxuICBjdHgubW92ZVRvKGxpbmUuc3RhcnQueCwgbGluZS5zdGFydC55KTtcclxuICBjdHgubGluZVRvKGxpbmUuZW5kLngsIGxpbmUuZW5kLnkpO1xyXG4gIGN0eC5zdHJva2UoKTtcclxufVxyXG5cclxuZXhwb3J0IHtkcmF3fTtcclxuIiwiaW1wb3J0ICogYXMgcGh5c2ljcyBmcm9tICcuL3BoeXNpY3MnO1xyXG5pbXBvcnQgKiBhcyBkcmF3IGZyb20gJy4vZHJhdyc7XHJcbmltcG9ydCBQbGFuZSBmcm9tICcuL3BsYW5lJztcclxuaW1wb3J0ICogYXMgdXRpbCBmcm9tICcuL3V0aWwnO1xyXG5pbXBvcnQge1ZlY3RvcjJkfSBmcm9tICcuL2ludGVyZmFjZXMnO1xyXG5cclxubGV0IE1JTl9NU19CRVRXRUVOX1VQREFURVMgPSAyMDsgLy8gfjUwIEZQU1xyXG5cclxuLyogU3RhcnRzIHRoZSBtYWluIGxvb3AgKi9cclxuZnVuY3Rpb24gYW5pbWF0ZShjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50LCBwbGFuZTogUGxhbmUpIHtcclxuICBsZXQgbGFzdFVwZGF0ZVRpbWU7XHJcblxyXG4gIC8vIEhhbmRsZXMgYWxsIGFuaW1hdGlvbiBmcmFtZXMgYWZ0ZXIgdGhlIGZpcnN0XHJcbiAgZnVuY3Rpb24gdXBkYXRlKHRpbWVzdGFtcDogbnVtYmVyKSB7XHJcbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodXBkYXRlKTtcclxuXHJcbiAgICBpZiAodGltZXN0YW1wIDwgbGFzdFVwZGF0ZVRpbWUgKyBNSU5fTVNfQkVUV0VFTl9VUERBVEVTKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHBoeXNpY3MuYWR2YW5jZVRpbWUocGxhbmUsICh0aW1lc3RhbXAgLSBsYXN0VXBkYXRlVGltZSkgLyAxMDAwKTtcclxuICAgIGRyYXcuZHJhdyhwbGFuZSwgY2FudmFzKTtcclxuICAgIGxhc3RVcGRhdGVUaW1lID0gdGltZXN0YW1wO1xyXG4gIH1cclxuXHJcbiAgLy8gUGVyZm9ybSBpbml0aWFsIHNldHVwIHRoZW4gc2V0IGFuaW1hdGlvbiBydW5uaW5nLlxyXG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbih0aW1lc3RhbXApIHtcclxuICAgIGxhc3RVcGRhdGVUaW1lID0gdGltZXN0YW1wO1xyXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHVwZGF0ZSk7XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKiBDcmVhdGVzIGluaXRpYWwgb2JqZWN0cyBhbmQgc3RhcnRzIHRoZSBtYWluIGxvb3AgKi9cclxuZnVuY3Rpb24gc3RhcnQoKSB7XHJcbiAgbGV0IHBsYW5lID0gbmV3IFBsYW5lKHt4OiAwLCB5OjMwfSk7XHJcblxyXG4gIGxldCBjYW52YXMgPSA8SFRNTENhbnZhc0VsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpO1xyXG4gIGNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG4gIGNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcblxyXG4gIGF0dGFjaERyYWdIYW5kbGVyKGNhbnZhcywgcGxhbmUpO1xyXG4gIGFkZFBhcnRpY2xlcyhwbGFuZSxjYW52YXMsMTApO1xyXG4gIGFuaW1hdGUoY2FudmFzLCBwbGFuZSk7XHJcbn1cclxuXHJcbi8qIEFkZHMgJ251bScgcmFuZG9tIHBhcnRpY2xlcyB0byB0aGUgcGxhbmUgKi9cclxuZnVuY3Rpb24gYWRkUGFydGljbGVzKHBsYW5lOiBQbGFuZSwgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCwgbnVtOiBudW1iZXIpIHtcclxuICBmb3IgKGxldCBpID0gMDsgaSA8IG51bTsgaSsrKSB7XHJcbiAgICBsZXQgcG9zID0ge3g6IGNhbnZhcy53aWR0aCAvIDIsIHk6IGNhbnZhcy5oZWlnaHQgLyAyfTtcclxuICAgIGxldCB2ZWwgPSB1dGlsLmdldFJhbmRvbVZlbChjYW52YXMpO1xyXG4gICAgcGxhbmUuYWRkUGFydGljbGUocG9zLHZlbCk7XHJcbiAgfVxyXG59XHJcblxyXG4vKiBBdHRhY2hlcyBldmVudHMgdG8gdGhlIGNhbnZhcyB0byBmYWNpbGlhdGUgbmV3IHBhcnRpY2xlIGNyZWF0aW9uLiAqL1xyXG5mdW5jdGlvbiBhdHRhY2hEcmFnSGFuZGxlcihjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50LCBwbGFuZTogUGxhbmUpIHtcclxuICBsZXQgc3RhcnRQb3MgOiBWZWN0b3IyZCB8IG51bGw7XHJcbiAgY2FudmFzLm9ubW91c2Vkb3duID0gZnVuY3Rpb24oZXZ0KSB7XHJcbiAgICBzdGFydFBvcyA9IHV0aWwuZ2V0Q3Vyc29yUG9zKGNhbnZhcywgZXZ0KTtcclxuICB9O1xyXG4gIGNhbnZhcy5vbm1vdXNldXAgPSBmdW5jdGlvbihldnQpIHtcclxuICAgIGlmIChzdGFydFBvcyAhPSBudWxsKSB7XHJcbiAgICAgIGxldCBwb3MgPSB1dGlsLmdldEN1cnNvclBvcyhjYW52YXMsZXZ0KTtcclxuICAgICAgbGV0IHZlbCA9IHt4OiBwb3MueCAtIHN0YXJ0UG9zLngsIHk6IHBvcy55IC0gc3RhcnRQb3MueX07XHJcbiAgICAgIHBsYW5lLmFkZFBhcnRpY2xlKHBvcywgdmVsKTtcclxuICAgICAgc3RhcnRQb3MgPSBudWxsO1xyXG4gICAgfVxyXG4gIH07XHJcbn1cclxuXHJcbi8vXHJcbnN0YXJ0KCk7XHJcbiIsImltcG9ydCB7UGxhbmV9IGZyb20gJy4vaW50ZXJmYWNlcyc7XHJcblxyXG4vKiBBZHZhbmNlcyB0aW1lIG9uIHRoZSBwbGFuZSBieSB0aGUgZ2l2ZW4gbnVtYmVyIG9mIHNlY29uZHMsIGFwcGx5aW5nXHJcbiAqIHZlbG9jaXR5IGFuZCBncmF2aXR5LiAqL1xyXG5mdW5jdGlvbiBhZHZhbmNlVGltZShwbGFuZTogUGxhbmUsIHNlY29uZHM6IG51bWJlcikgOiBQbGFuZSB7XHJcbiAgbGV0IHBhcnRpY2xlcyA9IHBsYW5lLnBhcnRpY2xlcztcclxuICBsZXQgbGluZXMgPSBwbGFuZS5saW5lcztcclxuXHJcbiAgZm9yIChsZXQgcGFydGljbGUgb2YgcGFydGljbGVzKSB7XHJcbiAgICAgIHBhcnRpY2xlLnZlbC54ICs9IHBsYW5lLmdyYXZpdHkueCAqIHNlY29uZHM7XHJcbiAgICAgIHBhcnRpY2xlLnZlbC55ICs9IHBsYW5lLmdyYXZpdHkueSAqIHNlY29uZHM7XHJcblxyXG4gICAgICBwYXJ0aWNsZS5wb3MueCArPSBwYXJ0aWNsZS52ZWwueCAqIHNlY29uZHM7XHJcbiAgICAgIHBhcnRpY2xlLnBvcy55ICs9IHBhcnRpY2xlLnZlbC55ICogc2Vjb25kcztcclxuICB9XHJcblxyXG4gIHJldHVybiBwbGFuZTtcclxufVxyXG5cclxuZXhwb3J0IHthZHZhbmNlVGltZX1cclxuIiwiaW1wb3J0IHsgUGxhbmUgYXMgSVBsYW5lLCBWZWN0b3IyZCwgUGFydGljbGUsIExpbmUgfSBmcm9tICcuL2ludGVyZmFjZXMnO1xyXG5cclxuLyogUHJvdmlkZXMgYSBzaW1wbGUgUGxhbmUgaW1wbGVtZW50YXRpb24uICovXHJcbmNsYXNzIFBsYW5lIGltcGxlbWVudHMgSVBsYW5lIHtcclxuICBwYXJ0aWNsZXM6IFBhcnRpY2xlW10gPSBbXTtcclxuICBsaW5lczogTGluZVtdID0gW107XHJcbiAgZ3Jhdml0eTogVmVjdG9yMmQ7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGdyYXZpdHk6IFZlY3RvcjJkKSB7XHJcbiAgICB0aGlzLmdyYXZpdHkgPSBncmF2aXR5O1xyXG4gIH1cclxuXHJcbiAgYWRkUGFydGljbGUocG9zOiBWZWN0b3IyZCwgdmVsOiBWZWN0b3IyZCkge1xyXG4gICAgdGhpcy5wYXJ0aWNsZXMucHVzaCh7cG9zOiBwb3MsIHZlbDogdmVsfSk7XHJcbiAgfVxyXG4gIGFkZExpbmUoc3RhcnQ6IFZlY3RvcjJkLCBlbmQ6IFZlY3RvcjJkKSB7XHJcbiAgICB0aGlzLmxpbmVzLnB1c2goe3N0YXJ0OiBzdGFydCwgZW5kOiBlbmR9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFBsYW5lO1xyXG4iLCJpbXBvcnQge1ZlY3RvcjJkfSBmcm9tICcuL2ludGVyZmFjZXMnXHJcblxyXG4vKiBGZXRjaGVzIGNvb3JkaW5hdGVzIG9uIGNhbnZhcyBmcm9tIG1vdXNlIGNsaWNrICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRDdXJzb3JQb3MoY2FudmFzIDogSFRNTENhbnZhc0VsZW1lbnQsIGV2ZW50KSA6IFZlY3RvcjJkIHtcclxuICAgIGxldCByZWN0ID0gY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgbGV0IHggPSBldmVudC5jbGllbnRYIC0gcmVjdC5sZWZ0O1xyXG4gICAgbGV0IHkgPSBldmVudC5jbGllbnRZIC0gcmVjdC50b3A7XHJcbiAgICByZXR1cm4ge3g6IHgsIHk6IHl9O1xyXG59XHJcblxyXG4vKiBSZXR1cm5zIGEgcmFuZG9tIHZlbG9jaXR5IGJldHdlZW4gMSUgLSA1JSBvZiB0aGUgc2l6ZSBvZiB0aGUgY2FudmFzICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRSYW5kb21WZWwoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCkgOiBWZWN0b3IyZCB7XHJcbiAgbGV0IHcgPSBjYW52YXMud2lkdGg7XHJcbiAgbGV0IGggPSBjYW52YXMuaGVpZ2h0O1xyXG4gIGxldCB4ID0gKHcgKiAwLjAxKSArICh3ICogMC4wNCAqIE1hdGgucmFuZG9tKCkpO1xyXG4gIGxldCB5ID0gKGggKiAwLjAxKSArIChoICogMC4wNCAqIE1hdGgucmFuZG9tKCkpO1xyXG4gIHJldHVybiB7eDogeCwgeTogeX07XHJcbn1cclxuIl19
